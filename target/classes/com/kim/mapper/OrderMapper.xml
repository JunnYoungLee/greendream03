<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.kim.mapper.OrderMapper">
	 <!-- 창고 전체 리스트 -->
	 <select id="list" resultType="com.kim.model.OrderDTO">
	 	select * from stock;
	 </select>
	<!--  부서별 창고 리스트 -->
	 <select id="medical_department_list" resultType="com.kim.model.OrderDTO">
	 	select * from stock
	 	where dept = #{dept};
	 </select>
	 <!-- 소모량으로 현재고 업데이트 -->
	 <update id="current_quantity_update">
	 	update stock
	 	set current_quantity = #{current_quantity}
	 	where dept = #{dept} and medical_supply_code = #{medical_supply_code}
	 </update>
	<!--  소모량 체크 -->
	 <insert id="consumption_check">
	 	insert into consumption_check 
	 	values(#{dept}, #{medical_supply_code}, #{medical_supplies_name}, 
	 	#{standard}, #{unit}, #{used_quantity}, #{current_quantity}, 
	 	#{date}, #{person_in_charge});
	 </insert>
	 <!-- 구입 요청하기 -->
	 <insert id="request_check" >
	 	insert into request_check(dept,medical_supply_code,
	 	medical_supplies_name,standard,unit,supplier,
	 	unit_price,current_quantity,safety_inventory_quantuty,request_quantity
		,person_in_charge,date,special_note,progress_status)
	 	
	 	values(#{dept}, #{medical_supply_code}, #{medical_supplies_name}, 
	 	#{standard}, #{unit}, #{supplier}, #{unit_price}, #{current_quantity}, 
	 	#{safety_inventory_quantuty}, #{request_quantity}, #{person_in_charge}, 
	 	#{date}, #{special_note}, #{progress_status});
	 </insert>
	<!--  요청 목록 -->
	 <select id="request_list" resultType="com.kim.model.OrderDTO">
	 	select *, 
	 	unit_price*request_quantity as supply_price,
	 	unit_price*request_quantity*0.1 as surtax,
	 	unit_price*request_quantity + unit_price*request_quantity*0.1 as total_price
	 	from request_check;
	 </select>
	 <!-- 공급회사별 요청목록 -->
	 <select id="request_selected_list" resultType="com.kim.model.OrderDTO">
	 	select *, 
	 	unit_price*request_quantity as supply_price,
	 	unit_price*request_quantity*0.1 as surtax,
	 	unit_price*request_quantity + unit_price*request_quantity*0.1 as total_price
	 	from request_check
	 	where supplier = #{supplier};
	 </select>
	 <!-- 요청 목록 삭제 -->
	 <delete id="request_delete">
	 	delete from request_check 
	 	where rno = #{del_rno};
	 </delete>
	 
	 <update id="gps_update">
	 	update gps
	 	set latitude = #{latitude},
	 	longitude = #{longitude}
	 	where gno = 1;
	 </update>
	 
	 <select id="gps_info" resultType="com.kim.model.GpsDTO">
	 	select * from gps;
	 </select>
	 
</mapper>